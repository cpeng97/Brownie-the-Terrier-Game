<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brownie: AIGC Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body { margin: 0; background-color: #2c1e1a; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        canvas { border: 5px solid #5d4037; border-radius: 8px; }
    </style>
</head>
<body>
<script>
const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    scene: { preload: preload, create: create, update: update }
};

const game = new Phaser.Game(config);
let brownie, hand, score = 0, bites = 0, gameState = 'ONBOARDING';
let uiPanel, dogMood = 'calm';

// HELPER FUNCTION: This resizes any image to a specific width while keeping it perfect
function fitToWidth(item, targetWidth) {
    const scale = targetWidth / item.width;
    item.setScale(scale);
}

function preload() {
    // 1. Background & Overlays
    this.load.image('bg', 'assets/bg/bg_room.png');
    this.load.image('ol_apple', 'assets/bg/bg_overlay_apple.png');
    this.load.image('ol_barrel', 'assets/bg/bg_overlay_barrel.png');
    this.load.image('ol_bush', 'assets/bg/bg_overlay_bush.png');
    this.load.image('ol_grass', 'assets/bg/bg_overlay_dry_grass.png'); 
    this.load.image('ol_wood', 'assets/bg/bg_overlay_wood.png');

    // 2. Brownie Sprites
    this.load.image('b_idle', 'assets/sprites/brownie_idle.png');
    this.load.image('b_happy', 'assets/sprites/brownie_happy.png');
    this.load.image('b_bite', 'assets/sprites/brownie_bite.png');

    // 3. Hand
    this.load.image('h_neutral', 'assets/sprites/hand_neutral.png');
    this.load.image('h_pet', 'assets/sprites/hand_petting.png');

    // 4. UI Elements
    this.load.image('ui_box', 'assets/ui/ui_dialogue_box.png');
    this.load.image('btn_start', 'assets/ui/ui_button_start.png');
}

function create() {
    // BACKGROUND: Force it to fill the 800x600 screen exactly
    const background = this.add.image(400, 300, 'bg');
    background.setDisplaySize(800, 600);

    // OVERLAYS: Force them to reasonable sizes
    const barrel = this.add.image(150, 480, 'ol_barrel').setDepth(10);
    fitToWidth(barrel, 180);

    const bush = this.add.image(650, 480, 'ol_bush').setDepth(10);
    fitToWidth(bush, 220);

    const wood = this.add.image(400, 520, 'ol_wood').setDepth(10);
    fitToWidth(wood, 200);

    // BROWNIE: The star of the show
    brownie = this.add.sprite(400, 400, 'b_idle').setInteractive().setVisible(false);
    fitToWidth(brownie, 140); // Make her 140 pixels wide

    // HAND: Follows the mouse
    hand = this.add.sprite(0, 0, 'h_neutral').setDepth(100);
    fitToWidth(hand, 100); // Make the hand 100 pixels wide
    this.input.setDefaultCursor('none');
    this.input.on('pointermove', (p) => { hand.setPosition(p.x, p.y); });

    // UI PANEL: Dialogue and Start Button
    uiPanel = this.add.container(400, 300).setDepth(200);
    const box = this.add.image(0, 0, 'ui_box');
    fitToWidth(box, 500);

    const startBtn = this.add.image(0, 80, 'btn_start').setInteractive();
    fitToWidth(startBtn, 160);

    const title = this.add.text(0, -60, "Meet Brownie!", { fontSize: '36px', color: '#5d4037', fontStyle: 'bold' }).setOrigin(0.5);
    const instruction = this.add.text(0, 0, "Tap to pet Brownie when she's calm!", { fontSize: '18px', color: '#795548' }).setOrigin(0.5);

    startBtn.on('pointerdown', () => {
        uiPanel.destroy();
        gameState = 'PLAY';
        spawnBrownie();
    });

    uiPanel.add([box, title, instruction, startBtn]);

    // Petting Logic
    brownie.on('pointerdown', () => {
        score += 10;
        brownie.setTexture('b_happy');
        this.time.delayedCall(400, () => brownie.setVisible(false));
    });
}

function spawnBrownie() {
    if (gameState !== 'PLAY') return;

    // Random location
    const x = Phaser.Math.Between(150, 650);
    const y = Phaser.Math.Between(250, 450);
    
    brownie.setPosition(x, y).setVisible(true).setTexture('b_idle');

    game.scene.scenes[0].time.delayedCall(1800, () => {
        brownie.setVisible(false);
        if (gameState === 'PLAY') game.scene.scenes[0].time.delayedCall(1000, spawnBrownie);
    });
}

function update() {}
</script>
</body>
</html>
